# 电商微服务学习项目

## 项目理解

### 项目概况
这是一个基于现代微服务架构的电商交易系统学习项目，采用企业级技术栈和DDD领域驱动设计理念。项目严格遵循中大型互联网公司的技术规范和架构模式，旨在通过渐进式的学习路径，从基础设施搭建到完整业务实现，全面掌握微服务开发的核心技术。

**项目名称**: ecommerce-microservices-learning
**当前状态**: 第零阶段末尾（基础设施搭建完成，准备进入技术验证阶段）

### 技术架构栈

#### 后端技术栈
- **核心框架**: JDK 21 + Spring Boot 3.2.x + Spring Cloud 2023.x + Spring Cloud Alibaba 2023.x
- **微服务治理**: Spring Cloud Gateway + Nacos 2.5.1 服务注册发现 + 配置中心
- **数据持久化**: MySQL 8.0.43 + MyBatis-Plus 3.x + Druid 连接池
- **缓存方案**: Redis 7.4.6 + Redisson 3.x 分布式锁
- **消息队列**: RocketMQ 5.3.2
- **服务通信**: OpenFeign + 负载均衡
- **监控运维**: Spring Boot Actuator + Micrometer + Prometheus + Grafana
- **注**: 分布式事务将在后期单独引入

#### 前端技术栈
- **核心框架**: Vue 3.x + Composition API
- **UI组件库**: Element Plus 2.x
- **路由管理**: Vue Router 4.x
- **状态管理**: Pinia 2.x
- **构建工具**: Vite 5.x
- **HTTP客户端**: Axios 1.x

#### 开发工具链
- **构建工具**: Maven 3.x
- **代码质量**: ESLint + Prettier
- **容器化**: Docker + Docker Compose
- **编排工具**: Kubernetes (规划中)

### 项目架构设计

#### 整体架构
项目采用经典的微服务分层架构，严格按照DDD（领域驱动设计）思想进行服务拆分：

```
┌─────────────────┐    ┌──────────────────┐
│   前端 Vue 3.4    │    │   API Gateway    │
│                 │────│                 │
│   Element Plus  │    │ Spring Cloud     │
└─────────────────┘    │   8080          │
                         └──────────────────┘
                                   │
                 ┌─────────────────┼─────────────────┐
                 │                 │                 │
         ┌───────┴───────┐ ┌───────┴───────┐ ┌───────┴───────┐
         │ User Service ││Product Service││ Trade Service │
         │   28081      ││   28082       ││   28083       │
         └─────────────┘└─────────────┘└─────────────┘
                 │                 │                 │
                 └─────────────────┼─────────────────┘
                                   │
                 ┌─────────────────┼─────────────────┐
                 │    MySQL 8.0    │     Redis 7.0     │
                 │    商品库       │     缓存层        │
                 └─────────────────┴─────────────────┘
```

#### 微服务划分
按照业务领域进行服务拆分，每个服务都有明确的业务边界和职责：

1. **API Gateway (端口: 28080)**
   - 统一API入口和路由转发
   - JWT认证和权限控制
   - 请求限流和熔断降级
   - 跨域处理和安全防护

2. **User Service (端口: 28081)**
   - 用户注册、登录、认证管理
   - 用户信息维护和权限控制
   - JWT令牌生成和验证
   - 用户会话管理

3. **Product Service (端口: 28082)**
   - 商品分类和基础信息管理
   - 商品搜索和筛选功能
   - 库存管理和价格策略
   - 商品缓存优化

4. **Trade Service (端口: 28083)**
   - 购物车管理和订单创建
   - 交易流程和状态机设计
   - 支付处理和资金账户管理
   - 交易风控规则

#### DDD架构模式
每个微服务内部都采用标准的DDD四层架构：

```
┌─────────────────────────────────────────┐
│             interfaces 层                │
│  ┌─────────────┬─────────────┬─────────────┐ │
│  │   REST API  │   RPC接口  │  事件处理器  │ │
│  └─────────────┴─────────────┴─────────────┘ │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│            application 层               │
│  ┌─────────────┬─────────────┬─────────────┐ │
│  │  应用服务   │  事件处理器  │  定时任务   │ │
│  └─────────────┴─────────────┴─────────────┘ │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│              domain 层                    │
│  ┌─────────────┬─────────────┬─────────────┐ │
│  │   领域模型  │  领域服务   │  领域事件   │ │
│  │  (实体/值对象)│            │            │ │
│  └─────────────┴─────────────┴─────────────┘ │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│         infrastructure 层                 │
│  ┌─────────────┬─────────────┬─────────────┐ │
│  │  持久化实现  │  消息队列   │  外部客户端  │ │
│  │ (MyBatis)   │  (RocketMQ) │   (Feign)   │ │
│  └─────────────┴─────────────┴─────────────┘ │
└─────────────────────────────────────────┘
```

### 项目结构详解

#### 完整目录结构
```
ecommerce-microservices-learning/
├── backend/                           # 后端微服务集群
│   ├── pom.xml                       # Maven父项目配置
│   ├── common/                       # 公共模块（待实现业务代码）
│   │   └── src/main/java/com/cao/ecommerce/common/
│   │       ├── annotation/          # 注解定义
│   │       ├── constant/            # 常量定义
│   │       ├── exception/           # 异常处理
│   │       ├── model/               # 通用模型
│   │       ├── mq/                  # 消息队列相关
│   │       └── util/                # 工具类
│   ├── api-gateway/                  # API网关服务（框架已搭建）
│   │   └── src/main/java/com/cao/ecommerce/gateway/
│   │       ├── config/              # 网关配置（待实现）
│   │       ├── filter/              # 过滤器（待实现）
│   │       └── fallback/           # 降级处理（待实现）
│   ├── user-service/                 # 用户服务（框架已搭建）
│   ├── product-service/              # 商品服务（框架已搭建）
│   ├── trade-service/                # 交易服务（框架已搭建）
│   └── [每个服务都包含完整的DDD四层架构目录结构]
├── frontend/                          # 前端单页应用（框架已搭建）
│   ├── package.json
│   ├── vite.config.js
│   ├── src/
│   │   ├── components/             # 通用组件
│   │   ├── views/                  # 页面组件
│   │   ├── router/                 # 路由配置
│   │   ├── stores/                 # 状态管理
│   │   ├── api/                    # API接口（待实现）
│   │   └── utils/                  # 工具函数
│   └── public/                      # 静态资源
├── deploy/                            # 部署配置（已完善）
│   ├── docker-compose/              # 开发环境
│   │   └── compose/                # Docker Compose配置
│   │       ├── docker-compose.yml
│   │       ├── docker-compose.infra.yml
│   │       └── docker-compose.apps.yml
│   └── kubernetes/                  # 生产环境（规划中）
├── infrastructure/                    # 基础设施配置（已完善）
│   ├── database/                    # 数据库脚本
│   ├── nginx/                       # 负载均衡配置
│   └── monitoring/                  # 监控配置
├── docs/                             # 项目文档
│   ├── 需求.md                      # 业务需求文档
│   ├── 开发计划.md                  # 详细实施计划
│   ├── api/                         # API文档（规划中）
│   ├── database/                    # 数据库设计（规划中）
│   └── deployment/                  # 部署文档（规划中）
├── README.md                         # 项目说明
├── CLAUDE.md                         # AI助手项目记忆文件
└── .gitignore                       # Git忽略配置
```

#### 核心模块详解

**Common模块**
- 提供跨服务的通用组件和工具类
- 定义统一的异常处理和响应格式
- 封装分布式锁、ID生成器等基础设施组件
- 提供消息队列的通用封装

**API Gateway模块**
- 作为整个系统的统一入口
- 实现动态路由和负载均衡
- 提供认证授权、限流熔断等横切关注点
- 支持灰度发布和蓝绿部署

**业务服务模块**
每个业务服务都严格遵循DDD架构，包含：
- **interfaces层**: 对外提供REST API和RPC接口
- **application层**: 编排业务用例，处理应用服务
- **domain层**: 核心业务逻辑，包含领域模型和领域服务
- **infrastructure层**: 技术实现细节，如数据库访问、外部服务调用

### 关键技术特性

#### 微服务治理
- **服务注册发现**: 基于Nacos的自动服务注册
- **配置中心**: 统一的配置管理和动态刷新
- **负载均衡**: 客户端负载均衡和服务端负载均衡
- **熔断降级**: 基于OpenFeign的服务间调用保护

#### 数据一致性
- **分布式事务**: 将在后期单独引入（当前阶段暂不实现）
- **最终一致性**: 基于消息队列的事件驱动架构
- **幂等性设计**: 关键接口的幂等性保证
- **补偿机制**: 分布式事务失败的自动补偿

#### 缓存策略
- **多级缓存**: 本地缓存 + 分布式缓存
- **缓存更新**: Cache-Aside模式和Write-Through模式
- **缓存穿透/雪崩**: 布隆过滤器、空对象缓存
- **缓存一致性**: 延迟双删和消息通知

#### 监控运维
- **健康检查**: 基于Spring Boot Actuator
- **指标采集**: Micrometer指标收集
- **链路追踪**: 分布式请求追踪
- **日志聚合**: 结构化日志和集中收集

### 开发规范

#### 代码规范
- **命名规范**: 遵循阿里巴巴Java开发手册
- **注释要求**: 所有接口类必须有详细注释
- **异常处理**: 统一的异常处理和错误码定义
- **设计模式**: 合理运用设计模式，避免过度设计

#### Git协作
- **分支策略**: Git Flow工作流
- **提交规范**: 语义化提交信息
- **代码审查**: 关键功能的代码审查
- **持续集成**: 自动化构建和测试

#### 部署策略
- **容器化**: 基于Docker的应用打包
- **编排管理**: Kubernetes集群管理
- **环境隔离**: 开发、测试、生产环境分离
- **滚动更新**: 零停机的服务升级

### 学习价值

#### 技术深度
- **微服务架构**: 深入理解服务拆分、治理、通信
- **分布式系统**: 掌握CAP理论、分布式事务、最终一致性
- **云原生技术**: Docker、Kubernetes、服务网格
- **性能优化**: 缓存策略、数据库优化、并发编程

#### 工程实践
- **企业级开发**: 代码规范、协作流程、质量控制
- **系统设计**: 架构设计、系统建模、容量规划
- **运维实践**: 监控告警、故障排查、性能调优
- **项目管理**: 需求分析、进度控制、风险管理

#### 面试准备
- **架构设计**: 能够清晰地阐述架构设计决策
- **技术选型**: 合理解释技术选型的考虑因素
- **问题解决**: 具备复杂问题的分析和解决能力
- **项目亮点**: 能够展示项目的核心价值和创新点

这个项目不仅是一个学习项目，更是一个符合企业级标准的微服务架构实践案例，通过完整的技术栈和严格的架构设计，为学习现代微服务开发提供了最佳实践的参考。

---

## 当前实施状态

### 已完成阶段

#### 第零阶段：工程基础设施 ✅ **120%超额完成**
- **提交1**: 电商微服务项目基础框架搭建 (3044da5)
  - Maven多模块项目结构
  - 基础配置文件
  - Docker基础配置
- **提交2**: Docker开发环境配置 (499a2a8)
  - 优化Docker Compose目录结构
  - 完善基础设施服务配置
- **提交3**: 优化Docker Compose目录结构 (29e88b0)
  - 简化配置管理
  - 提高部署可维护性

**第零阶段实际成果**:
- ✅ 完整的项目框架搭建（Maven多模块结构）
- ✅ Docker开发环境配置完善并验证通过
- ✅ 前端Vue 3.4项目初始化
- ✅ 基础设施服务独立运行验证通过：
  - MySQL 8.0.43 (端口3306) - 数据库服务正常
  - Redis 7.4.6 (端口6379) - 缓存服务正常
  - Nacos 2.5.1 (端口18848->8848) - 注册中心服务正常（基础设施）
  - RocketMQ 5.3.2 (端口9876/10909/10911/18080) - 消息队列服务正常
- ✅ 所有微服务模块结构创建完成（框架独立，无外部依赖）
- ✅ **Docker网络配置优化**：自定义网络172.20.0.0/16，容器间通信正常
- ✅ **健康检查机制配置**：所有基础设施服务配置了完整的健康检查
- ✅ **端口映射优化**：解决Windows 8848端口权限问题，使用18848端口
- ✅ **镜像源配置**：配置国内镜像源，解决镜像拉取问题
- ✅ **数据持久化配置**：Docker volumes配置，数据安全持久化
- ✅ **配置清理优化**：移除Seata分布式事务，简化架构复杂度
- ✅ **架构简化**：各业务服务独立，不依赖Nacos等外部服务
- ✅ **文档完善**：更新所有相关文档，记录实际配置和验证状态

### 下一阶段规划

#### 第一阶段：微服务技术骨架（待实施）
1. **服务注册发现实现**
   - 为各业务服务统一添加Nacos依赖
   - 配置Nacos服务注册相关配置
   - 实现各服务的启动类和基础HealthController
   - 验证服务注册成功

2. **API网关路由配置**
   - 配置动态路由规则
   - 实现跨域处理
   - 添加基础过滤器

3. **服务间基础通信**
   - 配置OpenFeign客户端
   - 实现服务调用示例
   - 添加熔断降级

### 技术验证清单

#### 高优先级验证项
- [ ] 所有微服务能正常启动
- [ ] 服务能成功注册到Nacos
- [ ] 网关能正确路由到各服务
- [ ] 服务间Feign调用正常
- [ ] 前端能通过网关访问后端API

#### 中优先级验证项
- [ ] 数据库连接正常
- [ ] Redis缓存读写正常
- [ ] 基础业务接口实现
- [ ] 前后端完整对接

### 学习价值记录

#### 已掌握技术点
- Maven多模块项目管理
- Docker容器化部署与编排
- Docker网络配置与端口映射
- Docker数据持久化volumes管理
- Spring Boot微服务框架搭建
- Vue 3.4前端项目初始化
- 企业级项目结构设计
- 基础设施服务配置与验证：
  - MySQL数据库配置与连接测试
  - Redis缓存配置与操作验证
  - Nacos服务注册发现配置与验证
  - RocketMQ消息队列配置与测试
- Windows环境Docker问题解决：
  - 端口权限冲突解决
  - 镜像拉取问题处理
  - 容器间网络通信配置

#### 下一阶段学习目标
- 微服务注册发现原理
- API网关配置和使用
- 服务间通信机制
- Spring Cloud技术栈应用

---

## 实施要求

### 电商微服务学习项目规划要求总结

#### 一、项目基本信息要求

- 基于README.md和docs/需求和架构文档，进行设计和规划
- 主要技术栈：JDK 21 + Spring Boot 3.3.5 + Vue 3.4
- 包名：com.cao.ecommerce（企业级规范）
- 架构：前后端分离，微服务 + DDD领域驱动设计

#### 二、规划核心原则

**1. 实现原则**
- 分步骤渐进：先搭建基础框架，确保技术打通，再分批实现业务
- 可学习性：每次提交清晰说明技术要点和修改说明，便于理解技术演进
- 技术验证：每个阶段确保技术栈正确配置和验证

**2. 技术先行原则**
- 先骨架后业务：快速搭建微服务技术骨架，验证技术栈连通性
- 先粗后细：避免过早陷入业务细节，专注技术成果验证
- 循序渐进：从基础设施→技术骨架→认证体系→数据层→服务通信→业务实现

**3. 前后端并行原则**
- 穿插开发：每个阶段前后端都有更新，确保能完整验证
- 功能对齐：前端不是学习重点，但要支撑后端技术验证
- 极简实现：登录页面 + 欢迎页面 + API测试界面 + 核心业务页面

#### 三、阶段性规划要求

**第零阶段：工程基础设施**

- **目标**：建立项目基础框架，打通技术基础设施
- **重点**：Git仓库、Maven结构、Docker环境、远程推送
- **验证**：技术环境就绪，代码能推送GitHub

**第一阶段：微服务技术骨架**

- **目标**：快速搭建所有微服务基础框架
- **重点**：Hello World接口、服务注册、网关路由
- **验证**：所有服务启动、注册、通过网关访问

**第二阶段：认证技术链路**

- **目标**：打通JWT认证技术链路
- **重点**：JWT生成解析、网关认证、token管理
- **验证**：认证拦截、自动携带、状态管理

**第三阶段：数据层技术验证**

- **目标**：验证数据库、Redis、MyBatis等技术组件
- **重点**：数据库集成、CRUD操作、缓存实现
- **验证**：数据读写正常、缓存生效

**第四阶段：服务间通信验证**

- **目标**：验证OpenFeign、消息队列等服务间通信
- **重点**：服务调用、熔断降级、消息队列
- **验证**：服务间调用成功、消息收发正常

**第五阶段：业务场景实现**

- **目标**：按docs/需求.md的6个场景顺序实现
- **重点**：业务逻辑、技术细节、用户体验
- **验证**：完整业务流程、数据一致性

#### 四、每个阶段的输出要求

**1. 阶段定义**
- 明确目标：本阶段要解决什么技术问题
- 具体任务：前后端分别要实现什么功能
- 学习价值：能学到什么技术点和业务知识
- 验证标准：如何确认技术已经打通

**2. 提交规划**
- 合理拆分：每个阶段2-3个提交，保持节奏
- 渐进式：每个提交都是可运行状态
- 技术导向：前期专注技术，后期深入业务

**3. 学习导向**
- 注释策略：所有接口类必须有注释，核心方法、面试重点代码详细注释
- 技术说明：每次提交说明实现的功能和技术要点
- 配置说明：重要配置变更要解释原因
- 问题记录：遇到的技术难点和解决方案

#### 五、技术验证优先级

**高优先级（前期重点）**

1. 微服务连通性：所有服务能启动、注册、互相访问
2. 认证体系：JWT认证链路完整
3. 数据通路：数据库、Redis读写正常
4. 服务通信：OpenFeign、消息队列正常工作

**中优先级（中期重点）**

1. 基础业务：用户注册登录、商品浏览
2. 缓存策略：Redis缓存应用
3. 简单交互：购物车基础功能

**低优先级（后期重点）**

1. 复杂业务：订单创建、支付流程
2. 分布式事务：Seata集成应用
3. 系统完善：监控、日志、部署

#### 六、学习目标导向

**技术学习**
- 微服务架构：服务拆分、治理、通信
- 分布式系统：缓存、消息队列、事务
- 云原生：Docker、Kubernetes、监控
- 工程化：Git协作、CI/CD、文档

**业务学习**
- 电商交易：完整的业务流程理解
- 领域建模：DDD设计思想应用
- 系统设计：高并发、高可用架构设计

**面试准备**
- 项目亮点：每个阶段都有技术亮点可讲
- 问题解决：记录技术难点和解决方案
- 架构理解：能说清楚设计决策和技术选型

#### 七、成功标准

**技术标准**
- 可运行：每个提交都是可工作的状态
- 可验证：有明确的验证方法和标准
- 可扩展：架构支持后续功能扩展

**学习标准**
- 可理解：代码注释清晰，技术演进脉络清楚
- 可复现：环境配置和部署流程完整
- 可展示：有完整的功能演示链路