# 技术约束和设计规范（学习项目版）

## 🎯 核心原则

### 学习项目定位
- **功能优先**：先确保功能正确，再考虑优化
- **理解优先**：重点是理解架构和设计原理
- **渐进式学习**：从简单到复杂，逐步深入
- **实用导向**：避免过度工程化

## 🏗️ 架构约束（核心要求）

### Common 模块约束（绝对禁止）
**🚨 重要教训**：Common是共享组件，不是业务服务！

**禁止**：
- ❌ Web依赖：`spring-boot-starter-web`
- ❌ Web注解：`@RestController`、`@RequestMapping`
- ❌ Controller类、Service类、业务逻辑

**只能包含**：
- ✅ DTO类、常量、异常、工具类、枚举、注解

### DDD 分层架构（必须理解）
```
interfaces/     # 接口层 - REST API、请求响应
application/    # 应用层 - 业务流程协调（可简化）
domain/         # 领域层 - 核心业务逻辑
infrastructure/ # 基础设施层 - 数据库、外部服务
```

**基本要求**：
- 理解分层概念和职责边界
- 避免跨层直接调用
- 保持领域层的相对独立性

**学习初期可简化**：
- 应用层可以先简单，重点是理解概念
- 复杂的领域事件后期再实现
- 仓储模式先理解基本用法

### 微服务边界（基本概念）
- **User Service**: 用户相关功能
- **Product Service**: 商品相关功能
- **Trade Service**: 交易相关功能
- **API Gateway**: 路由和基础认证

**基本要求**：
- 理解服务边界概念
- 避免功能职责混乱
- 服务间通过API调用，不直接访问数据库

## 📝 编码规范（必须遵守）

### 包命名规范（强制）
```
根包名: com.cao.ecommerce
服务包名: com.cao.ecommerce.{service}
通用包名: com.cao.ecommerce.common
```

### 类命名规范（强制）
| 类型 | 命名模式 | 示例 |
|------|----------|------|
| 实体类 | 名词，驼峰 | User, Product, Order |
| 服务类 | 名词+Service | UserService, ProductService |
| 控制器 | 名词+Controller | UserController, ProductController |
| DTO类 | 名词+DTO/Request/Response | UserDTO, CreateUserRequest |

### 方法命名规范（强制）
- **查询方法**: findXxx, getXxx, searchXxx
- **操作方法**: createXxx, updateXxx, deleteXxx
- **验证方法**: validateXxx, checkXxx

## 🔧 技术栈约束（基本要求）

### 框架版本（使用当前版本）
```xml
<properties>
    <spring-boot.version>3.2.x</spring-boot.version>
    <spring-cloud.version>2023.0.x</spring-cloud.version>
    <spring-cloud-alibaba.version>2023.0.x</spring-cloud-alibaba.version>
</properties>
```

**基本要求**：
- 使用项目已有的技术栈版本
- 避免引入不必要的新依赖
- 基础配置统一管理

### 配置管理（基本要求）
- 开发、测试环境配置分离
- 敏感信息（如密码）使用环境变量
- 数据库连接等配置统一管理

## 🗄️ 数据库设计约束（基础要求）

### 表结构规范（必须遵守）
- **表名**: 单数蛇形命名（user, product, order）
- **字段名**: 蛇形命名（user_id, create_time）
- **基础字段**: id, create_time, update_time（学习项目可简化）
- **主键**: BIGINT 类型，使用自增ID（学习项目适用）

### 数据类型规范（基本要求）
| 字段类型 | 适用场景 | 示例 |
|---------|----------|------|
| BIGINT | 主键、ID | user_id, order_id |
| DECIMAL(10,2) | 金额字段 | price, amount |
| DATETIME | 时间字段 | create_time, update_time |
| TINYINT | 状态字段 | status, type |
| VARCHAR | 字符串字段 | name, description |

### 索引规范（基本要求）
- **唯一索引**: uk_ 前缀（如 uk_user_email）
- **普通索引**: idx_ 前缀（如 idx_user_status）
- **原则**: 按需添加，不过度优化

## 🔌 API 设计约束（基础要求）

### RESTful 规范（必须理解）
- **GET**: 查询操作
- **POST**: 创建操作
- **PUT**: 更新操作
- **DELETE**: 删除操作

### 响应格式规范（统一使用）
```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1234567890
}
```

### 基本错误码（学习项目适用）
- **200**: 成功
- **400**: 请求参数错误
- **401**: 未授权
- **404**: 资源不存在
- **500**: 服务器内部错误
- **1000-1999**: 业务错误码（按需添加）

## 🔒 安全约束（基本要求）

### 基础安全（必须实现）
- **密码存储**: 使用 BCrypt 加密
- **输入验证**: 基本的参数校验
- **接口鉴权**: 业务接口需要进行权限验证

### 学习项目暂不要求
- 复杂的安全策略
- 高级加密算法
- 复杂的权限控制

## 📋 Git 规范（必须遵守）

### 提交信息格式（强制）
```
<type>(<scope>): <subject>
```

**类型说明**：
- feat: 新功能
- fix: 修复问题
- docs: 文档更新
- style: 代码格式调整
- refactor: 代码重构
- test: 测试相关
- chore: 构建工具或辅助工具变动

### 分支管理（基本要求）
- **main**: 主分支，稳定代码
- **develop**: 开发分支
- **feature/***: 功能开发分支
- **hotfix/***: 紧急修复分支

## 🚀 性能约束（参考标准）

### 响应时间（学习项目宽松标准）
- **API响应**: < 1s（功能优先）
- **数据库查询**: < 500ms（基础查询）
- **缓存命中**: < 50ms（使用缓存时）

### 资源使用（基本要求）
- 合理使用内存，避免明显泄漏
- 数据库连接池配置合理
- 不要求严格的资源限制

## 🧪 测试约束（学习项目要求）

### 测试覆盖（基础要求）
- **核心业务逻辑**: 基本功能测试
- **Controller层**: 基本的接口测试
- **整体覆盖率**: 30-50%（学习项目适用）

### 测试分类（理解概念）
- **单元测试**: 测试单个方法
- **集成测试**: 测试多组件协作
- **接口测试**: 测试API功能

### 不强制要求
- 100% 的代码覆盖率
- 复杂的性能测试
- 压力测试

## 📦 部署约束（基本要求）

### 容器化（学习项目适用）
- **镜像大小**: 合理即可，不强制限制
- **启动时间**: < 60s（学习项目宽松）
- **基础健康检查**: 提供基本的健康检查接口

### 环境管理（基本要求）
- 使用配置中心管理配置
- 确保开发和测试环境基本一致
- 数据库变更提供基本脚本

## 🔄 渐进式学习路径

### 第一阶段：基础实现
- ✅ 遵循基本的架构分层
- ✅ 实现核心功能
- ✅ 基本的错误处理
- ✅ 统一的响应格式

### 第二阶段：逐步完善
- 添加基础的缓存机制
- 实现基本的认证授权
- 优化数据库查询
- 补充必要的测试

### 第三阶段：深入实践
- 复杂的业务场景实现
- 性能优化
- 高级特性应用
- 企业级考虑

## ⚠️ 禁止事项

### 架构约束（绝对禁止）
- 跨层直接调用（如 interfaces → domain）
- 在Controller中实现复杂业务逻辑
- 微服务间直接访问数据库
- 忽略基本的安全要求
- **Common模块包含Web依赖或Controller类**

### 编码约束（绝对禁止）
- 硬编码敏感信息
- 忽略基本异常处理
- 不遵循命名规范
- 提交不规范的代码

## 💡 学习建议

### 重点关注
- 理解微服务架构的基本概念
- 掌握DDD分层的基本思想
- 实践RESTful API设计
- 学习基础的数据库设计

### 后续深入
- 性能优化技巧
- 高级设计模式
- 复杂业务场景处理
- 企业级实践

---

**文档版本**: v2.0 (学习项目版)
**约束级别**: 核心约束必须遵守，建议约束参考执行
**更新机制**: 根据学习进展逐步完善
**核心原则**: 功能正确优先，理解原理优先