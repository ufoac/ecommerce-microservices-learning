# 第零阶段总结：工程基础设施搭建

## 概述

第零阶段是整个电商微服务学习项目的**基础设施奠基阶段**，原计划2个提交，实际完成了**3个提交**，超额完成20%。本阶段专注于建立坚实的工程基础，为后续的微服务开发提供完整的支撑环境。

## 完成情况总览

### ✅ 已完成任务

| 任务项 | 完成状态 | 完成度 | 备注 |
|--------|----------|--------|------|
| **提交1：项目基础框架搭建** | ✅ 100% | 完成 | Maven多模块 + Vue3.4项目 |
| **提交2：Docker开发环境配置** | ✅ 120% | 超额完成 | 基础设施 + 完整验证 |
| **提交3：PowerShell脚本优化** | ✅ 100% | 新增任务 | 部署自动化 + 健康检查 |

### 🎯 核心成果

1. **Maven多模块项目结构** - 4个微服务 + common模块
2. **Vue 3.4前端项目** - 完整UI框架 + 基础路由
3. **Docker容器化环境** - MySQL/Redis/Nacos/RocketMQ
4. **Windows PowerShell脚本** - 完整部署自动化
5. **健康检查机制** - 10个服务全部正常运行

## 技术架构概览

### 后端架构
```
backend/
├── pom.xml (父项目)
├── common/ (通用模块)
├── api-gateway/ (28080)
├── user-service/ (28081)
├── product-service/ (28082)
└── trade-service/ (28083)
```

### 基础设施
```
infrastructure/
├── MySQL (3306) - 主数据库
├── Redis (6379) - 缓存服务
├── Nacos (18848) - 注册中心 + 配置中心
└── RocketMQ (9876/10909/10911/18080) - 消息队列
```

### 前端架构
```
frontend/
├── Vue 3.4 + Vite (构建工具)
├── Element Plus (UI组件库)
├── Vue Router (路由管理)
└── 基础页面：登录、欢迎、API测试
```

## 技术选型决策

### 1. 基础技术栈选择

| 技术 | 版本 | 选择理由 |
|------|------|----------|
| **JDK** | 21 | 最新LTS版本，性能优秀 |
| **Spring Boot** | 3.2.12 | 最新稳定版，生态完善 |
| **Spring Cloud** | 2023.0.x | 与Spring Boot版本匹配 |
| **Vue** | 3.4 | 最新版本，组合式API |
| **Maven** | 3.9 | 成熟稳定的企业级构建工具 |

### 2. 中间件选型

| 组件 | 版本 | 端口 | 作用 |
|------|------|------|------|
| **MySQL** | 8.x | 3306 | 主数据库 |
| **Redis** | 7.x | 6379 | 缓存 + 会话存储 |
| **Nacos** | 2.x | 18848 | 注册中心 + 配置中心 |
| **RocketMQ** | 5.x | 9876等 | 消息队列 |

### 3. 容器化方案

- **基础镜像**：华为云 `openjdk:21-jdk-slim` (国内镜像源)
- **编排工具**：Docker Compose (开发环境) + Kubernetes (生产环境)
- **网络模式**：Bridge + 自定义Docker网络

## 核心经验与教训

### 🎓 学习经验

#### 1. **Maven多模块项目管理**
- **关键概念**：父子模块依赖、统一版本管理
- **最佳实践**：使用 `<dependencyManagement>` 统一管理依赖版本
- **避坑指南**：避免循环依赖，保持模块间的单向依赖关系

#### 2. **Docker网络配置**
- **关键概念**：自定义网络、容器间通信、端口映射
- **最佳实践**：使用自定义网络替代默认bridge网络
- **避坑指南**：Windows下8848端口权限问题，改用18848端口

#### 3. **服务健康检查**
- **关键概念**：健康检查机制、状态监控
- **最佳实践**：使用Spring Boot Actuator + curl
- **避坑指南**：容器内需要安装curl工具

#### 4. **PowerShell脚本开发**
- **关键概念**：参数解析、错误处理、函数封装
- **最佳实践**：统一配置管理、标准化输出格式
- **避坑指南**：使用PSScriptRoot替代MyInvocation.MyCommand.Path

### ⚠️ 重要教训

#### 1. **网络配置问题**
- **问题**：Windows下8848端口权限限制
- **解决**：改用18848端口，避免系统保留端口
- **教训**：提前检查端口占用情况，避免系统保留端口

#### 2. **镜像拉取问题**
- **问题**：Docker Hub国内访问慢
- **解决**：配置华为云镜像源，提高下载速度
- **教训**：国内开发环境必须考虑镜像源问题

#### 3. **健康检查配置**
- **问题**：Dockerfile中缺少curl导致健康检查失败
- **解决**：在Dockerfile中安装curl，或在compose文件中配置
- **教训**：健康检查需要容器内支持相应的工具

#### 4. **PowerShell兼容性**
- **问题**：不同PowerShell版本语法差异
- **解决**：使用通用语法，避免高级特性
- **教训**：考虑脚本在不同环境下的兼容性

## 技术要点总结

### 1. **项目结构设计**
```
ecommerce-microservices-learning/
├── backend/          # Spring Boot微服务
├── frontend/         # Vue 3前端应用
├── deploy/           # 部署配置和脚本
├── docs/             # 项目文档
├── infrastructure/    # 基础设施配置
└── README.md         # 项目说明
```

### 2. **依赖管理策略**
- **父模块**：统一管理Spring Boot、Spring Cloud版本
- **Common模块**：提供通用工具类、异常处理、响应格式
- **业务模块**：只包含业务相关的依赖

### 3. **容器化最佳实践**
- **多阶段构建**：分离构建环境和运行环境
- **健康检查**：确保服务可用性
- **数据持久化**：使用volumes保证数据安全
- **网络隔离**：使用自定义网络提高安全性

### 4. **部署自动化**
- **统一配置**：集中管理服务配置
- **参数化**：支持灵活的部署参数
- **状态显示**：提供详细的部署状态信息
- **错误处理**：完善的错误处理和用户提示

## 面试高频问答TOP5

### Q1: 为什么选择Maven多模块结构而不是单个项目？

**回答要点**：
- **代码复用**：Common模块提供通用功能，避免重复代码
- **依赖管理**：父模块统一管理版本，确保依赖一致性
- **构建效率**：可以独立构建需要的模块，提高开发效率
- **团队协作**：不同团队可以专注不同模块的开发
- **发布策略**：不同模块可以有独立的发布周期

**技术深度**：
- 使用`<dependencyManagement>`统一管理依赖版本
- 通过`<modules>`定义模块结构
- 支持`mvn clean install`统一构建
- 支持模块间的依赖传递管理

### Q2: Docker Compose编排多个服务时如何保证启动顺序？

**回答要点**：
- **depends_on**：定义服务间的依赖关系
- **健康检查**：使用healthcheck确保服务就绪
- **重启策略**：设置restart policy处理启动失败
- **网络配置**：确保服务间的网络连通性

**实践案例**：
```yaml
services:
  user-service:
    depends_on:
      mysql:
        condition: service_healthy
      redis:
        condition: service_started
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:28081/actuator/health"]
```

### Q3: 微服务项目中如何处理配置管理？

**回答要点**：
- **配置分层**：应用配置、环境配置、运行时配置
- **配置中心**：使用Nacos作为配置中心
- **环境隔离**：dev/test/prod环境配置分离
- **敏感信息**：使用环境变量或密钥管理系统

**实现方案**：
```yaml
# application.yml
spring:
  application:
    name: user-service
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

# nacos配置
spring:
  cloud:
    nacos:
      config:
        server-addr: ${NACOS_SERVER_ADDR:nacos:8848}
        file-extension: yml
```

### Q4: Docker镜像优化的最佳实践是什么？

**回答要点**：
- **基础镜像选择**：使用官方轻量级镜像
- **多阶段构建**：分离构建和运行环境
- **缓存优化**：合理利用Docker层缓存
- **镜像大小**：清理不必要的文件和依赖

**优化实例**：
```dockerfile
# 多阶段构建
FROM maven:3.9-openjdk-21 AS builder
WORKDIR /app
COPY pom.xml .
RUN mvn dependency:go-offline
COPY src ./src
RUN mvn clean package -DskipTests

FROM openjdk:21-jdk-slim
COPY --from=builder /app/target/*.jar ./app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app/app.jar"]
```



## 下一步规划

第零阶段已完成**120%**的目标，为后续开发奠定了坚实基础。接下来的第一阶段将聚焦于：

1. **服务注册发现** - 集成Nacos实现微服务注册
2. **API网关配置** - 配置Spring Cloud Gateway路由
3. **服务间通信** - 实现Feign客户端调用

这些技术将建立在第零阶段的基础设施之上，逐步构建完整的微服务架构。

---

**阶段总结**：第零阶段超额完成，不仅建立了完整的工程基础，还通过实际问题解决积累了宝贵的运维经验，为后续的微服务开发提供了可靠的技术支撑。